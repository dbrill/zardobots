#include "bandpassFilter.h"

static int filter_taps[BANDPASSFILTER_TAP_NUM] = {
  11306380,
  2310915,
  2327950,
  2183202,
  1866657,
  1378132,
  728109,
  -61552,
  -958018,
  -1918530,
  -2891955,
  -3821194,
  -4646591,
  -5308912,
  -5753021,
  -5932192,
  -5810955,
  -5368434,
  -4601312,
  -3524407,
  -2172746,
  -599851,
  1123262,
  2911298,
  4668545,
  6293684,
  7685262,
  8747534,
  9396865,
  9566891,
  9214266,
  8322199,
  6903264,
  5000927,
  2688606,
  67703,
  -2736461,
  -5580745,
  -8310838,
  -10769594,
  -12805686,
  -14282429,
  -15086438,
  -15135331,
  -14384634,
  -12830177,
  -10514615,
  -7521279,
  -3978932,
  -51231,
  4069356,
  8168910,
  12024812,
  15417763,
  18143283,
  20024037,
  20921085,
  20743215,
  19454302,
  17076993,
  13693459,
  9445095,
  4526024,
  -827622,
  -6344853,
  -11738006,
  -16713984,
  -20992720,
  -24321948,
  -26492177,
  -27349471,
  -26805723,
  -24845622,
  -21529738,
  -16993917,
  -11443560,
  -5144604,
  1589309,
  8413018,
  14967402,
  20898875,
  25879031,
  29622658,
  31904806,
  32573737,
  31560844,
  28886040,
  24658548,
  19072891,
  12399928,
  4974062,
  -2825014,
  -10590888,
  -17914082,
  -24403371,
  -29707785,
  -33536404,
  -35673486,
  -35990856,
  -34455769,
  -31133657,
  -26187083,
  -19869182,
  -12510048,
  -4495801,
  3757286,
  11825978,
  19286097,
  25705886,
  30809091,
  34291400,
  35992304,
  35830324,
  33827851,
  30106527,
  24879890,
  18441047,
  11145885,
  3392589,
  -4401139,
  -11821180,
  -18480600,
  -24041276,
  -28231680,
  -30861720,
  -31831943,
  -31137033,
  -28865325,
  -25190520,
  -20360614,
  -14681041,
  -8495445,
  -2164327,
  3956879,
  9538986,
  14298393,
  18012489,
  20532074,
  21787278,
  21789568,
  20627936,
  18459824,
  15498606,
  11996796,
  8227166,
  4463417,
  960439,
  -2063095,
  -4439428,
  -6062729,
  -6895302,
  -6968692,
  -6378143,
  -5277201,
  -3857070,
  -2341025,
  -953471,
  92033,
  612429,
  475358,
  -389241,
  -1981062,
  -4224578,
  -6970680,
  -10004957,
  -13061417,
  -15841110,
  -18033242,
  -19338276,
  -19494493,
  -18301522,
  -15638972,
  -11485697,
  -5926472,
  841640,
  8515139,
  16695433,
  24908485,
  32630730,
  39320080,
  44450205,
  47546018,
  48219084,
  46198943,
  41359712,
  33738882,
  23546394,
  11164304,
  -2864876,
  -17860427,
  -33034735,
  -47534147,
  -60485320,
  -71046089,
  -78457345,
  -82092890,
  -81504248,
  -76456972,
  -66957158,
  -53262751,
  -35884424,
  -15567805,
  6734978,
  29908870,
  52731730,
  73937764,
  92288025,
  106642113,
  116025459,
  119690392,
  117168482,
  108311098,
  93313322,
  72714869,
  47378356,
  18461255,
  -12619988,
  -44302085,
  -74904033,
  -102751936,
  -126253256,
  -143992798,
  -154815307,
  -157897641,
  -152805145,
  -139528495,
  -118498069,
  -90574361,
  -57015382,
  -19420543,
  20345852,
  60247085,
  98179622,
  132084656,
  160059798,
  180466809,
  192025784,
  193894210,
  185723018,
  167687799,
  140492209,
  105342918,
  63896852,
  18182557,
  -29499335,
  -76694050,
  -120919594,
  -159799160,
  -191189972,
  -213301642,
  -224798898,
  -224880993,
  -213333962,
  -190552892,
  -157531076,
  -115817520,
  -67444082,
  -14825381,
  39363435,
  92325055,
  141283861,
  183640238,
  217096009,
  239801341,
  250437295,
  248303096,
  233361675,
  206244068,
  168224262,
  121161094,
  67406032,
  9682898,
  -49052689,
  -105766665,
  -157504442,
  -201547201,
  -235558374,
  -257708422,
  -266774072,
  -262207758,
  -244167717,
  -213516488,
  -171777402,
  -121058973,
  -63946164,
  -3366417,
  57562911,
  115697417,
  168030263,
  211850336,
  244884354,
  265417197,
  272382172,
  265417197,
  244884354,
  211850336,
  168030263,
  115697417,
  57562911,
  -3366417,
  -63946164,
  -121058973,
  -171777402,
  -213516488,
  -244167717,
  -262207758,
  -266774072,
  -257708422,
  -235558374,
  -201547201,
  -157504442,
  -105766665,
  -49052689,
  9682898,
  67406032,
  121161094,
  168224262,
  206244068,
  233361675,
  248303096,
  250437295,
  239801341,
  217096009,
  183640238,
  141283861,
  92325055,
  39363435,
  -14825381,
  -67444082,
  -115817520,
  -157531076,
  -190552892,
  -213333962,
  -224880993,
  -224798898,
  -213301642,
  -191189972,
  -159799160,
  -120919594,
  -76694050,
  -29499335,
  18182557,
  63896852,
  105342918,
  140492209,
  167687799,
  185723018,
  193894210,
  192025784,
  180466809,
  160059798,
  132084656,
  98179622,
  60247085,
  20345852,
  -19420543,
  -57015382,
  -90574361,
  -118498069,
  -139528495,
  -152805145,
  -157897641,
  -154815307,
  -143992798,
  -126253256,
  -102751936,
  -74904033,
  -44302085,
  -12619988,
  18461255,
  47378356,
  72714869,
  93313322,
  108311098,
  117168482,
  119690392,
  116025459,
  106642113,
  92288025,
  73937764,
  52731730,
  29908870,
  6734978,
  -15567805,
  -35884424,
  -53262751,
  -66957158,
  -76456972,
  -81504248,
  -82092890,
  -78457345,
  -71046089,
  -60485320,
  -47534147,
  -33034735,
  -17860427,
  -2864876,
  11164304,
  23546394,
  33738882,
  41359712,
  46198943,
  48219084,
  47546018,
  44450205,
  39320080,
  32630730,
  24908485,
  16695433,
  8515139,
  841640,
  -5926472,
  -11485697,
  -15638972,
  -18301522,
  -19494493,
  -19338276,
  -18033242,
  -15841110,
  -13061417,
  -10004957,
  -6970680,
  -4224578,
  -1981062,
  -389241,
  475358,
  612429,
  92033,
  -953471,
  -2341025,
  -3857070,
  -5277201,
  -6378143,
  -6968692,
  -6895302,
  -6062729,
  -4439428,
  -2063095,
  960439,
  4463417,
  8227166,
  11996796,
  15498606,
  18459824,
  20627936,
  21789568,
  21787278,
  20532074,
  18012489,
  14298393,
  9538986,
  3956879,
  -2164327,
  -8495445,
  -14681041,
  -20360614,
  -25190520,
  -28865325,
  -31137033,
  -31831943,
  -30861720,
  -28231680,
  -24041276,
  -18480600,
  -11821180,
  -4401139,
  3392589,
  11145885,
  18441047,
  24879890,
  30106527,
  33827851,
  35830324,
  35992304,
  34291400,
  30809091,
  25705886,
  19286097,
  11825978,
  3757286,
  -4495801,
  -12510048,
  -19869182,
  -26187083,
  -31133657,
  -34455769,
  -35990856,
  -35673486,
  -33536404,
  -29707785,
  -24403371,
  -17914082,
  -10590888,
  -2825014,
  4974062,
  12399928,
  19072891,
  24658548,
  28886040,
  31560844,
  32573737,
  31904806,
  29622658,
  25879031,
  20898875,
  14967402,
  8413018,
  1589309,
  -5144604,
  -11443560,
  -16993917,
  -21529738,
  -24845622,
  -26805723,
  -27349471,
  -26492177,
  -24321948,
  -20992720,
  -16713984,
  -11738006,
  -6344853,
  -827622,
  4526024,
  9445095,
  13693459,
  17076993,
  19454302,
  20743215,
  20921085,
  20024037,
  18143283,
  15417763,
  12024812,
  8168910,
  4069356,
  -51231,
  -3978932,
  -7521279,
  -10514615,
  -12830177,
  -14384634,
  -15135331,
  -15086438,
  -14282429,
  -12805686,
  -10769594,
  -8310838,
  -5580745,
  -2736461,
  67703,
  2688606,
  5000927,
  6903264,
  8322199,
  9214266,
  9566891,
  9396865,
  8747534,
  7685262,
  6293684,
  4668545,
  2911298,
  1123262,
  -599851,
  -2172746,
  -3524407,
  -4601312,
  -5368434,
  -5810955,
  -5932192,
  -5753021,
  -5308912,
  -4646591,
  -3821194,
  -2891955,
  -1918530,
  -958018,
  -61552,
  728109,
  1378132,
  1866657,
  2183202,
  2327950,
  2310915,
  11306380
};

void bandpassFilter_init(bandpassFilter* f) {
  int i;
  for(i = 0; i < BANDPASSFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void bandpassFilter_put(bandpassFilter* f, int input) {
  f->history[f->last_index++] = input;
  if(f->last_index == BANDPASSFILTER_TAP_NUM)
    f->last_index = 0;
}

int bandpassFilter_get(bandpassFilter* f) {
  long long acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < BANDPASSFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : BANDPASSFILTER_TAP_NUM-1;
    acc += (long long)f->history[index] * filter_taps[i];
  };
  return acc >> 32;
}
